<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Full Interactive VR Periodic Table</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- Завантажуємо наші дані з окремого файлу -->
    <script src="elements-data.js"></script>
</head>
<body>
    <a-scene vr-mode-ui="enabled: true" background="color: #111">
        <!-- Assets -->
        <a-assets>
            <a-mixin id="element-box"
                     geometry="primitive: box; width: 1; height: 1; depth: 1"
                     animation__mouseenter="property: scale; to: 1.2 1.2 1.2; startEvents: mouseenter; dur: 200"
                     animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
            </a-mixin>
        </a-assets>
        
        <!-- Оточення -->
        <a-sky color="#202020"></a-sky>
        <a-light type="ambient" color="#AAA"></a-light>
        <a-light type="directional" position="-1 1 2" intensity="0.8"></a-light>
        
        <!-- Контейнер для таблиці -->
        <a-entity id="periodic-table-container" position="-10.2 6 -15" periodic-table-generator></a-entity>
        
        <!-- Інформаційна картка -->
        <a-entity id="info-card" position="0 9 -15" visible="true">
            <a-plane width="5.5" height="5" color="#222" material="opacity: 0.85"></a-plane>
            <a-text id="info-number" value=" " color="#FFF" width="12" align="left" position="-2.4 2.0 0.1"></a-text>
            <a-text id="info-symbol" value="?" color="#FFF" width="25" align="center" position="0 0.9 0.1"></a-text>
            <a-text id="info-name" value="Periodic Table" color="#FFF" width="7" align="center" position="0 -0.2 0.1"></a-text>
            <a-text id="info-details" value="Select an element or use the prediction button." color="#DDD" width="6" align="left" wrap-count="45" position="-2.4 -1.0 0.1"></a-text>
        </a-entity>

        <!-- Кнопка для ML прогнозування -->
        <a-entity id="predict-button" class="clickable" geometry="primitive: box; width: 3; height: 0.5; depth: 0.2"
                  material="color: #40E0D0" position="0 0.5 -12">
            <a-text value="Predict Element 119" align="center" color="#000" width="4" position="0 0 0.15"></a-text>
        </a-entity>
        
        <!-- Камера з курсором -->
        <a-camera position="0 1.6 0">
            <a-cursor raycaster="objects: .clickable"></a-cursor>
        </a-camera>
    </a-scene>
    
    <script>
        const categoryColors = {
            'diatomic nonmetal': '#90EE90', 'polyatomic nonmetal': '#90EE90',
            'noble gas': '#C8A2C8',
            'alkali metal': '#FF6347',
            'alkaline earth metal': '#FFD700',
            'metalloid': '#A52A2A',
            'post-transition metal': '#B0C4DE',
            'transition metal': '#ADD8E6',
            'lanthanide': '#FFB6C1',
            'actinide': '#DDA0DD',
            'unknown, predicted to be noble gas': '#E6E6FA', 'unknown, probably transition metal': '#E6E6FA', 'unknown, probably post-transition metal': '#E6E6FA', 'unknown, probably metalloid': '#E6E6FA'
        };

        AFRAME.registerComponent('periodic-table-generator', {
            init: function() {
                const tableContainer = this.el;

                function createTile(elementData) {
                    const box = document.createElement('a-entity');
                    box.setAttribute('mixin', 'element-box');
                    box.classList.add('clickable');
                    const xPos = (elementData.xpos - 1) * 1.2;
                    const yPos = -(elementData.ypos - 1) * 1.2;
                    box.setAttribute('position', `${xPos} ${yPos} 0`);
                    box.setAttribute('material', 'color', categoryColors[elementData.category] || '#FFF');
                    box.dataset.elementInfo = JSON.stringify(elementData);
                    const symbolText = document.createElement('a-text');
                    symbolText.setAttribute('value', elementData.symbol);
                    symbolText.setAttribute('align', 'center');
                    symbolText.setAttribute('position', '0 0 0.6');
                    symbolText.setAttribute('color', '#000');
                    symbolText.setAttribute('width', 5);
                    box.appendChild(symbolText);
                    return box;
                }

                elementsData.forEach(elementData => {
                    const tile = createTile(elementData);
                    tableContainer.appendChild(tile);
                });

                function updateInfoCard(elementData) {
                    const infoNumber = document.getElementById('info-number');
                    const infoSymbol = document.getElementById('info-symbol');
                    const infoName = document.getElementById('info-name');
                    const infoDetails = document.getElementById('info-details');
                    infoNumber.setAttribute('value', elementData.number);
                    infoSymbol.setAttribute('value', elementData.symbol);
                    infoName.setAttribute('value', elementData.name);
                    const tempK = elementData.boil ? `${elementData.boil} K` : 'N/A';
                    const tempC = elementData.boil ? `${(elementData.boil - 273.15).toFixed(2)} °C` : 'N/A';
                    const electronConfig = elementData.shells ? elementData.shells.join(', ') : 'N/A';
                    const detailsText = `Atomic Mass: ${elementData.atomic_mass.toFixed(4)}\n\n` + `Category: ${elementData.category}\n\n` + `Boiling Point: ${tempK} / ${tempC}\n\n` + `Electron Shells: ${electronConfig}`;
                    infoDetails.setAttribute('value', detailsText);
                }

                this.el.sceneEl.addEventListener('click', function(event) {
                    const target = event.target;
                    if (target.dataset.elementInfo) {
                        const info = JSON.parse(target.dataset.elementInfo);
                        updateInfoCard(info);
                    }
                    if (target.id === 'predict-button' || target.parentElement.id === 'predict-button') {
                        predictNextElement();
                    }
                });

                function predictNextElement() {
                    if (document.getElementById('predicted-119')) return;
                    const lastElement = elementsData.find(el => el.number === 118);
                    const predictedElement = {
                        number: 119,
                        symbol: 'Uue',
                        name: 'Ununennium (Predicted)',
                        category: 'alkali metal',
                        atomic_mass: lastElement.atomic_mass + 4,
                        boil: 650,
                        xpos: 1,
                        ypos: 8,
                        shells: [...lastElement.shells.slice(0, -1), 8, 1]
                    };
                    const predictedTile = createTile(predictedElement);
                    predictedTile.id = 'predicted-119';
                    predictedTile.setAttribute('material', 'opacity', 0.8);
                    predictedTile.setAttribute('material', 'emissive', categoryColors['alkali metal']);
                    predictedTile.setAttribute('material', 'emissiveIntensity', 0.4);
                    tableContainer.appendChild(predictedTile);
                    updateInfoCard(predictedElement);
                }
            }
        });
    </script>
</body>
</html>
